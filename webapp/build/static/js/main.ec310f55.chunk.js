(this.webpackJsonpwebapp=this.webpackJsonpwebapp||[]).push([[0],{32:function(e,t,n){e.exports=n(45)},37:function(e,t,n){},45:function(e,t,n){"use strict";n.r(t);var a=n(2),i=n.n(a),r=n(23),o=n.n(r),s=n(5),c=(n(37),n(14)),l=n(15),h=n(13),u=n(16),d="Temperature",f="Moisture",p="Light",v=i.a.createContext({currentOption:"Dashboard",setCurrentOption:function(e){throw new Error("setCurrentOption() not implemented.")}}),m=[{name:"Dashboard",indented:!1,icon:i.a.createElement(c.a,{size:20,color:"white"})},{name:d,indented:!0,icon:i.a.createElement(l.a,{size:20,color:"white"})},{name:f,indented:!0,icon:i.a.createElement(h.b,{size:20,color:"white"})},{name:p,indented:!0,icon:i.a.createElement(u.a,{size:20,color:"white"})},{name:"Movement",indented:!0,icon:i.a.createElement(u.b,{size:20,color:"white"})},{name:"Twitter",indented:!1,icon:i.a.createElement(l.b,{size:20,color:"white"})},{name:"Settings",indented:!1,icon:i.a.createElement(c.b,{size:20,color:"white"})}],g=function(){var e=Object(a.useContext)(v),t=e.currentOption,n=e.setCurrentOption;return i.a.createElement("div",{className:"menu"},m.map((function(e){return i.a.createElement("div",{key:e.name,className:"item  ".concat(e.name===t?"selected":""),onClick:function(){t!==e.name&&n(e.name)}},i.a.createElement("div",{className:"icon ".concat(e.indented?"indent":"")},e.icon),i.a.createElement("div",{className:"text"},e.name))})))},w=function(){return i.a.createElement("div",null,"I suggest to show here the status of IoT devices.",i.a.createElement("br",null),"Would be cool to have some kind of history as well.")},b=n(6),y=n.n(b),O=n(10),j=n(3),E=n(4);function D(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function k(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?D(n,!0).forEach((function(t){Object(j.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):D(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var x,S=function(e){var t=e.live,n=e.setLive,a=e.setTimePeriod,r=e.shouldRenderLive,o=e.conf;return i.a.createElement("div",{className:"control-pane"},t?i.a.createElement("div",null):i.a.createElement("div",{className:"".concat(o.name," time-button-group")},o.timePeriod.map((function(e){return i.a.createElement("div",{key:e.timePeriod,className:"time-button ".concat(e.selected?"selected":""),onClick:function(){e.selected||a(o.timePeriod.map((function(t){return k({},t,t===e?{selected:!t.selected}:{selected:!1})})))}},"".concat(e.timePeriod,"m"))}))),r?i.a.createElement("button",{className:"".concat(o.name," ").concat(t?"live":""),onClick:n},"Live"):null)},P=n(8),L=n(9),C=n(24),z=(x={},Object(j.a)(x,d,["#FF3D3D","#ff7521","#ffa500"]),Object(j.a)(x,f,["#125D92","#3AD8FC","#88F9FE"]),Object(j.a)(x,p,["#EFEFEF","#D1D1D1","#574A4B"]),x);var A={drawGradient:function(e,t,n){for(var a=[],i=z[n],r=0;r<i.length;r++)0===r?a.push({offset:"0%",color:i[r]}):a.push({offset:"".concat(100/(i.length-r),"%"),color:i[r]});var o=e.select("#linegradient");o.empty()&&(o=e.append("defs").append("linearGradient").attr("id","linegradient").attr("gradientUnits","userSpaceOnUse")),o.attr("x1",t.width/2).attr("y1",0).attr("x2",t.width/2).attr("y2",t.height).selectAll("stop").data(a).enter().append("stop").attr("offset",(function(e){return e.offset})).attr("stop-color",(function(e){return e.color}))}},M=["#ffa500","#ff2929","#7a7aed"],N=function(){function e(t){if(Object(L.a)(this,e),this.svgHTML=void 0,this.svg=void 0,this.viewport=void 0,this.margin=void 0,this.data=void 0,this.liveData=void 0,this.xScale=void 0,this.yScale=void 0,this.conf=void 0,this.tooltip=void 0,this.line=void 0,this.xAxis=void 0,this.yAxis=void 0,this.clip=void 0,this.dashedLines=void 0,this.live=void 0,this.live=!1,this.svgHTML=t.svg,this.margin={top:40,bottom:40,left:40,right:40},this.viewport={width:t.viewport.width-this.margin.left-this.margin.right,height:t.viewport.height-this.margin.top-this.margin.bottom},this.svg=E.j(t.svg).append("g").attr("transform","translate(".concat(this.margin.left,", ").concat(this.margin.right,")")),this.conf=t.conf,this.data=this.scaleData(t.data),this.liveData=[],this.getXScale(this.data),this.getYScale(this.data),this.tooltip=E.j(this.svgHTML.parentNode).append("div").attr("class","tooltip"),this.data instanceof Array)this.line=this.svg.append("path").attr("class","line").attr("stroke",this.conf.name===d||this.conf.name===f||this.conf.name===p?"url(#line-gradient)":M[0]);else if("object"===typeof this.data){var n=Object.keys(this.data);this.line=[];for(var a=0;a<n.length;a++)this.line.push(this.svg.append("path").attr("class","line").attr("stroke",M[a]))}this.clip=this.svg.append("g").attr("class","clip").append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",this.viewport.width).attr("height",this.viewport.height),this.xAxis=E.j(this.svgHTML).append("g").attr("class","x-axis"),this.yAxis=E.j(this.svgHTML).append("g").attr("class","y-axis").attr("transform","translate(".concat(this.margin.left,", ").concat(this.margin.top,")")),this.dashedLines=this.svg.append("g").classed("dashed-line-g",!0),this.conf.name!==d&&this.conf.name!==f&&this.conf.name!==p||A.drawGradient(this.svg,this.viewport,this.conf.name)}return Object(C.a)(e,[{key:"setConf",value:function(e,t){this.conf=e,this.data=this.scaleData(t),this.getXScale(this.data),this.getYScale(this.data),this.plot("update")}},{key:"scaleData",value:function(e){var t=this.conf.timePeriod;if(5!==t.timePeriod){var n=t.timePeriod/5;return this.computeData(e,n)}if(e instanceof Array)return Object(P.a)(e);if("object"===typeof e){var a={};for(var i in e)a[i]=Object(P.a)(e[i]);return a}return e}},{key:"computeData",value:function(e,t){if(e instanceof Array){for(var n=[],a=Math.ceil(e.length/t),i=0;i<a-1;i++){for(var r=0,o=0,s=0;s<t;s++){var c=i*t+s;r=0===s?e[c].value:(r+e[c].value)/2,0===s&&(o=e[c].time)}n.push({time:o,value:r})}return[].concat(n)}if("object"===typeof e){var l={};for(var h in e){for(var u=e[h],d=[],f=Math.ceil(u.length/t),p=0;p<f-1;p++){for(var v=0,m=0,g=0;g<t;g++){var w=p*t+g;v=0===g?u[w].value:(v+u[w].value)/2,0===g&&(m=u[w].time)}d.push({time:m,value:v})}l[h]=d}return l}return e}},{key:"setViewport",value:function(e){E.j(this.svgHTML).attr("width",e.width).attr("height",e.height),this.viewport={width:e.width-this.margin.left-this.margin.right,height:e.height-this.margin.top-this.margin.bottom},this.resize()}},{key:"setData",value:function(e){this.data=e,this.resize()}},{key:"goLive",value:function(){this.live=!0,this.dashedLines.html(""),this.xAxis.html(""),this.yAxis.html(""),this.line.remove(),this.line=this.svg.append("path").attr("clip-path","url(#clip)").attr("class","line").attr("stroke",this.conf.name===d||this.conf.name===f||this.conf.name===p?"url(#line-gradient)":M[0]),this.liveData=[],E.j(this.svgHTML).on("mousemove",null),E.j(this.svgHTML).on("mouseleave",null)}},{key:"addLiveData",value:function(e){this.liveData.push(e),this.plotLive()}},{key:"plotLive",value:function(){var e=this;if(this.liveData.length>2){this.getYScale(this.liveData.slice(1,this.liveData.length-1));var t=E.b(this.yScale).ticks(Math.floor(this.viewport.height/20));this.yAxis.transition().duration(400).call(t),this.getXScale(this.liveData);var n=E.a(this.xScale).ticks(Math.floor(this.viewport.height/40));this.xAxis.transition().duration(400).call(n);var a=E.g().x((function(t){return e.xScale(new Date(t.time))})).y((function(t){return e.yScale(t.value)})).curve(E.c);this.line.datum(this.liveData.slice(1)).attr("d",a).style("transform",null).transition().duration(300).attr("stroke",this.conf.name===d||this.conf.name===f||this.conf.name===p?"url(#linegradient)":M[0]).style("transform","translate(".concat(function(){return this.liveData.length>=30?this.xScale(this.liveData[0].time)-this.xScale(this.liveData[1].time):0}.bind(this)(),"px, 0)")),this.liveData.length>=30&&this.liveData.shift()}}},{key:"goHistory",value:function(){this.live=!1,this.getXScale(this.data),this.getYScale(this.data),this.line.remove(),this.line=this.svg.append("path").attr("class","line").attr("stroke",this.conf.name===d||this.conf.name===f||this.conf.name===p?"url(#line-gradient)":M[0]),this.plot("start")}},{key:"showTip",value:function(){var e=E.e,t=e.offsetX,n=e.offsetY,a=this.svg.select("circle");if(t>this.margin.left&&t<this.viewport.width+this.margin.left&&n>this.margin.top&&n<this.viewport.height+this.margin.top){var i=this.xScale.invert(t-this.margin.left);if(this.data instanceof Array){var r=this.data.findIndex((function(e){return e.time>i})),o=this.xScale(this.data[r].time);a.empty()?this.svg.append("circle").attr("cx",o).attr("cy",this.yScale(this.data[r].value)).attr("r",5).attr("fill","none").attr("stroke","white"):(a.attr("cx",this.xScale(this.data[r].time)).attr("cy",this.yScale(this.data[r].value)),this.tooltip.html("<p>".concat(new Date(this.data[r].time).toLocaleString(),"</p><p>Value: ").concat(this.data[r].value.toFixed(2),"</p>")).classed("show",!0).style("top",Math.floor(this.yScale(this.data[r].value)+this.margin.top-3)+"px").style("left",Math.floor(o+this.margin.left+5)+"px").style("margin-left",o>this.viewport.width/2?"-130px":"0px"))}}else a.empty()||a.remove(),this.tooltip.classed("show",!1)}},{key:"plot",value:function(e){var t=this;this.data instanceof Array&&this.data.length>1&&(E.j(this.svgHTML).on("mousemove",(function(){return t.showTip()})),E.j(this.svgHTML).on("mouseleave",(function(){t.svg.select("circle").remove(),t.tooltip.classed("show",!1)})));var n=E.k().duration(500).ease(E.d),a=E.g().x((function(e){return t.xScale(new Date(e.time))})).y((function(e){return t.yScale(e.value)})).curve(E.c),i=E.a(this.xScale).ticks(Math.floor(this.viewport.width/60));this.xAxis.attr("transform","translate(".concat(this.margin.left,", ").concat(this.viewport.height+this.margin.top,")")).call(i);var r=E.b(this.yScale).ticks(Math.floor(this.viewport.height/20));if(this.yAxis.call(r),this.dashedLines.html(""),r.scale().ticks(Math.floor(this.viewport.height/20)).forEach((function(e){t.dashedLines.append("line").classed("dashed-line",!0).attr("x1",0).attr("y1",t.yScale(e)).attr("x2",t.viewport.width).attr("y2",t.yScale(e))})),this.data instanceof Array)this.line.datum(this.data).attr("d",a).attr("stroke",this.conf.name===d||this.conf.name===f||this.conf.name===p?"url(#linegradient)":M[0]),"update"===e&&this.line.attr("stroke-dasharray",this.line.node().getTotalLength()+" "+this.line.node().getTotalLength()).attr("stroke-dashoffset",this.line.node().getTotalLength()).transition().duration(700).attr("stroke-dashoffset",0),"start"===e&&this.svg.attr("opacity",0).transition(n).attr("opacity",1),this.svg.selectAll(".dot");else if("object"===typeof this.data){var o=0;for(var s in this.data)this.line[o].datum(this.data[s]).attr("d",a),"update"===e&&this.line[o].attr("stroke-dasharray",this.line[o].node().getTotalLength()+" "+this.line[o].node().getTotalLength()).attr("stroke-dashoffset",this.line[o].node().getTotalLength()).transition().duration(700).attr("stroke-dashoffset",0),"start"===e&&this.svg.attr("opacity",0).transition(n).attr("opacity",1),this.svg.selectAll(".dot"),o++}}},{key:"clean",value:function(){delete this.svg,delete this.svgHTML,delete this.viewport,delete this.margin,delete this.data,delete this.liveData,delete this.yScale,delete this.xScale,delete this.conf,delete this.tooltip,delete this.line,delete this.xAxis,delete this.yAxis,delete this.clip,delete this.dashedLines}},{key:"resize",value:function(){this.conf.name!==d&&this.conf.name!==f&&this.conf.name!==p||A.drawGradient(this.svg,this.viewport,this.conf.name),this.clip.attr("width",this.viewport.width).attr("height",this.viewport.height),0!==this.liveData.length?(console.log(this.liveData),this.getXScale(this.liveData),this.getYScale(this.liveData),this.plotLive()):this.live||(this.getXScale(this.data),this.getYScale(this.data),this.plot())}},{key:"getXScale",value:function(e){if(e instanceof Array)this.xScale=E.i().domain([new Date(e[0].time),new Date(e[e.length-1].time)]).range([0,this.viewport.width]);else if("object"===typeof e){var t=[];for(var n in e){var a;(a=t).push.apply(a,Object(P.a)(E.f(e[n],(function(e){return e.time}))))}t=E.f(t),this.xScale=E.i().domain([new Date(t[0]),new Date(t[1])]).range([0,this.viewport.width])}}},{key:"getYScale",value:function(e){if(e instanceof Array)this.yScale=E.h().domain(E.f(e,(function(e){return e.value}))).range([this.viewport.height,0]);else if("object"===typeof e){var t=[];for(var n in e)t.push.apply(t,Object(P.a)(E.f(e[n],(function(e){return e.value}))));this.yScale=E.h().domain(E.f(t)).range([this.viewport.height,0])}}}]),e}();function T(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function F(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?T(n,!0).forEach((function(t){Object(j.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):T(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var R=function(e){var t=e.viewport,n=e.data,r=e.conf,o=e.control,c=void 0===o?{shouldRenderLive:!0}:o,l=Object(a.useRef)(null),h=Object(a.useState)(!1),u=Object(s.a)(h,2),d=u[0],f=u[1],p=Object(a.useState)([{timePeriod:5,selected:!0},{timePeriod:15,selected:!1},{timePeriod:30,selected:!1}]),v=Object(s.a)(p,2),m=v[0],g=v[1],w=Object(a.useState)(null),b=Object(s.a)(w,2),j=b[0],D=b[1];return Object(a.useEffect)((function(){n&&j&&l.current&&j.setData(n)}),[n,j]),Object(a.useEffect)((function(){j&&j.setConf(F({},r,{timePeriod:m.filter((function(e){return e.selected}))[0]}),n)}),[m]),Object(a.useEffect)((function(){j&&j.plot("start")}),[j]),Object(a.useEffect)((function(){return function(){var e=document.getElementById(r.id);e&&l.current&&l.current.removeChild(e)}}),[]),Object(a.useEffect)((function(){if(l.current){var e=l.current;if(1===e.childNodes.length){E.j(e).append("svg").attr("id",r.id).attr("width",t.width).attr("height",t.height);var a=document.getElementById(r.id);if(a){var i=new N({svg:a,viewport:t,data:n,conf:F({},r,{timePeriod:m.filter((function(e){return e.selected}))[0]})});D(i)}return function(){j&&j.clean()}}}}),[l.current]),Object(a.useEffect)((function(){if(l.current){var e=document.getElementById(r.id);if(e){var n=e.getBoundingClientRect();n.height===t.height&&n.width===t.width||j&&j.setViewport(t)}}}),[t]),Object(a.useEffect)((function(){if(j&&d){j.goLive();var e=setInterval(Object(O.a)(y.a.mark((function e(){var t,n;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("http://dowav-api.herokuapp.com/api/live/".concat(r.name));case 2:return t=e.sent,e.next=5,t.json();case 5:n=e.sent,r.zone?j.addLiveData(n[r.zone-1]):console.error("Please specify zone for Graphh with name "+r.name);case 7:case"end":return e.stop()}}),e)}))),2e3);return function(){clearInterval(e)}}}),[j,d]),i.a.createElement("div",{className:"graph ".concat(r.name," ").concat(d?"live":"")},i.a.createElement("div",{ref:l},i.a.createElement(S,{shouldRenderLive:c.shouldRenderLive,live:d,setLive:function(){d&&j&&j.goHistory(),f(!d)},setTimePeriod:g,conf:F({},r,{timePeriod:m})})))},H=n(11),I=n.n(H),B={timeout:{title:"Error",message:"Looks like the server is taking to long to respond, please try again in sometime.",actions:["refetch"]},fetchFail:{title:"Error",message:"We can't get data right now. Try a little bit later",actions:["refetch"]},noData:{title:"No Data.",message:"Seems like there is no data available at the moment.",actions:["refetch"]}},G={hostname:"https://dowav-api.herokuapp.com"};function q(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Y(e){var t=window.localStorage.getItem(e+"lastFetched");if(t&&I()(+t).isAfter(I()().add(-5,"minutes"))){var n=window.localStorage.getItem(e);if(n)return JSON.parse(n)}return null}function X(e){if(void 0===e)return"";var t=Object.keys(e);if(0===t.length)return"";for(var n="?",a=0;a<t.length;a++)n+="".concat(t[a],"=").concat(e[t[a]]).concat(a===t.length-1?"":"&");return n}function V(e){var t=e.useCache?Y(e.query.endpoint):null,n=Object(a.useState)({loading:!t,data:t||null,error:null}),i=Object(s.a)(n,2),r=i[0],o=i[1];function c(){console.log("useFetc",r),new Promise(function(){var t=Object(O.a)(y.a.mark((function t(n,a){var i,r,o,s;return y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=Date.now(),r=setTimeout((function(){a(B.timeout)}),1e4),t.prev=2,t.next=5,fetch("".concat(G.hostname).concat(e.query.endpoint).concat(X(e.query.params)));case 5:return o=t.sent,t.next=8,o.json();case 8:s=t.sent,console.log(s),clearTimeout(r),null===s&&a(B.noData),e.useCache&&(window.localStorage.setItem(e.query.endpoint,JSON.stringify(s)),window.localStorage.setItem(e.query.endpoint+"lastFetched",Date.now()+"")),Date.now()-i>500?n(s):setTimeout((function(){n(s)}),Date.now()-i),t.next=19;break;case 16:t.prev=16,t.t0=t.catch(2),a(B.fetchFail);case 19:case"end":return t.stop()}}),t,null,[[2,16]])})));return function(e,n){return t.apply(this,arguments)}}()).then((function(e){o({loading:!1,data:e,error:null})})).catch((function(e){o({loading:!1,error:e,data:null})}))}return Object(a.useEffect)((function(){if(0!==e.refetch)if(e.useCache){var t=Y(e.query.endpoint);t?o({loading:!1,data:t,error:null}):(o({loading:!0,data:null,error:null}),c())}else o({loading:!0,data:null,error:null}),c()}),[e.refetch]),Object(a.useEffect)((function(){t||c()}),[]),function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?q(n,!0).forEach((function(t){Object(j.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):q(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},r)}var J=n(17),Z=n(18);function Q(){var e=Object(J.a)(["\n  cx: 50%;\n  cy: 50%;\n  r: 50;\n  fill: none;\n  stroke-width: 10px;\n  stroke-dasharray: 160;\n  transform-origin: 50% 50%;\n  animation: "," 2s ease infinite;\n"]);return Q=function(){return e},e}function W(){var e=Object(J.a)(["\n    0%{\n        stroke-dashoffset: 290;\n    }\n    50%{\n        stroke-dashoffset: 50;\n    }\n    100%{\n        stroke-dashoffset: 290;\n    }\n"]);return W=function(){return e},e}var U=Object(Z.b)(W()),K=Z.a.circle(Q(),U),$=function(e){var t=e.size,n=e.currentOption,a=void 0===n?p:n;return i.a.createElement("svg",{stroke:z[a][1],width:t.width,height:t.height,className:"loader"},i.a.createElement(K,null))};function _(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function ee(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_(n,!0).forEach((function(t){Object(j.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var te=function(e){var t=e.error,n=e.onRefetch,a=void 0===n?function(){return console.warn("You haven't passed a fucntion")}:n,r=e.size,o=void 0===r?{width:"100%",height:"100%"}:r;return i.a.createElement("div",{className:"error-box",style:ee({},o)},i.a.createElement("h1",null,t.title),i.a.createElement("p",null,t.message),t&&t.actions&&t.actions.includes("refetch")?i.a.createElement("div",null,i.a.createElement(h.a,{size:"40",color:"white",className:"refetch-icon",onClick:a})):null)},ne=function(e){var t=e.currentOption,n=Object(a.useState)(0),r=Object(s.a)(n,2),o=r[0],c=r[1],l=Object(a.useState)(null),h=Object(s.a)(l,2),u=h[0],d=h[1],f=Object(a.useRef)(null),p=V({useCache:!0,query:{endpoint:"/api/historic/".concat(t.toLowerCase()),params:{from:1,to:Math.floor(Date.now()/1e3)}},refetch:o}),v=p.loading,m=p.data,g=p.error,w=function(){if(f.current){var e=f.current.getBoundingClientRect();d({width:e.width,height:e.height})}};return Object(a.useEffect)((function(){return f.current&&w(),window.addEventListener("resize",w),function(){return window.removeEventListener("resize",w)}}),[f.current]),i.a.createElement("div",{ref:f,className:"graph-view"},u?i.a.createElement(i.a.Fragment,null,v?i.a.createElement($,{size:u,currentOption:t}):g?i.a.createElement("div",{className:"error-message"},i.a.createElement(te,{error:g,onRefetch:function(){c(o+1)}})):i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"graph-view-row"},i.a.createElement(R,{data:m[0],viewport:{width:(u.width-50)/3,height:(u.height-100)/2},conf:{name:t,id:t+1,zone:1}}),i.a.createElement(R,{data:m[1],viewport:{width:(u.width-50)/3,height:(u.height-100)/2},conf:{name:t,id:t+2,zone:2}}),i.a.createElement(R,{data:m[2],viewport:{width:(u.width-50)/3,height:(u.height-100)/2},conf:{name:t,id:t+3,zone:3}})),i.a.createElement("div",{className:"graph-view-row"},i.a.createElement(R,{data:{zoneA:m[0],zoneB:m[1],zoneC:m[2]},control:{shouldRenderLive:!1},viewport:{width:u.width-10,height:(u.height-100)/2},conf:{name:t,id:t+4}})))):null)},ae=i.a.createContext({data:[],appendData:function(e){throw new Error("appenData() not implemented.")}}),ie=function(){var e=Object(a.useContext)(ae).data;return i.a.createElement("div",{className:"history-list"},i.a.createElement("h1",null,"History"),i.a.createElement("h4",null,"Last 24 hours"),e.map((function(e){var t=255-30*(e.value-1);return i.a.createElement("div",{className:"historic-item",style:{background:"rgb(".concat(t,", ").concat(t,", ").concat(t,")")}},"".concat(I()(e.time).format("D MMM HH:mm:ss")," - Zone ").concat(e.value))})))},re=n(1),oe=n(27),se=n(28),ce=function e(t){var n=this;Object(L.a)(this,e),this.scene=void 0,this.camera=void 0,this.renderer=void 0,this.controls=void 0,this.cube=void 0,this.locationData=void 0,this.createBox=function(){var e=new re.c(10.2,2.5,4.5333),t=[new re.G({color:2794705,transparent:!0,opacity:.65,side:re.i}),new re.G({color:2794705,transparent:!0,opacity:.7,side:re.i}),new re.G({color:2794705,transparent:!0,opacity:.66,side:re.i}),new re.G({color:2794705,transparent:!0,opacity:.67,side:re.i}),new re.G({color:2794705,transparent:!0,opacity:.68,side:re.i}),new re.G({color:2794705,transparent:!0,opacity:.69,side:re.i})];return new re.F(e,t)},this.updateViewport=function(e){n.camera.aspect=e.width/e.height,n.camera.updateProjectionMatrix(),n.renderer.setSize(e.width,e.height)},this.highlightZone=function(){n.locationData&&(n.cube.position.set(0,1.4,4.53*(n.locationData.value-1)-4.53),n.scene.remove(n.cube),n.scene.add(n.cube))},this.addLocationData=function(e){n.locationData=e,n.highlightZone()},this.animate=function(){requestAnimationFrame(n.animate),n.controls.update(),n.renderer.render(n.scene,n.camera)},this.scene=new re.Z,this.locationData=null,this.camera=new re.P(75,t.viewport.width/t.viewport.height,.1,1e3),this.controls=new se.a(this.camera,t.container),this.renderer=new re.pb({alpha:!0}),this.renderer.setClearColor(0,0),this.renderer.setSize(t.viewport.width,t.viewport.height),t.container.appendChild(this.renderer.domElement);var a=new re.Q(16777215,1.6,0);a.position.set(0,50,0),this.scene.add(a);var i=new re.Q(16777215,.6,0);i.position.set(-20,12,-25),this.scene.add(i);var r=new re.Q(16777215,.6,0);r.position.set(18,12,18),this.scene.add(r),this.cube=this.createBox(),(new oe.a).load("".concat("","/labmodel.glb"),(function(e){n.scene.add(e.scene),n.camera.position.set(-14,10,-9),n.camera.lookAt(0,0,0),n.controls.update()}),(function(e){console.log("".concat(e.loaded/e.total*100,"% loaded"))}),(function(e){console.log("ERROR. Can't load the model"),console.log(e)})),requestAnimationFrame(this.animate),this.animate()},le=function(e){var t=e.viewport,n=Object(a.useRef)(null),r=Object(a.useState)(null),o=Object(s.a)(r,2),c=o[0],l=o[1],h=Object(a.useContext)(ae),u=h.data,d=h.appendData;return Object(a.useEffect)((function(){n.current&&!c&&(console.log("Creating new lab"),l(new ce({viewport:t,container:n.current})))}),[n.current]),Object(a.useEffect)((function(){c&&c.updateViewport(t)}),[t]),Object(a.useEffect)((function(){if(u.length>0&&c){var e=u[u.length-1];c.addLocationData(e);var t=setInterval(Object(O.a)(y.a.mark((function e(){var t,n;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("http://dowav-api.herokuapp.com/api/location/live");case 3:return t=e.sent,e.next=6,t.json();case 6:n=e.sent,console.log(n),d(n),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),console.log(e.t0);case 14:case"end":return e.stop()}}),e,null,[[0,11]])}))),500);return function(){clearInterval(t)}}}),[u,c]),i.a.createElement("div",{ref:n,style:{width:t.width,height:t.height,outline:"none"}})};function he(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function ue(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?he(n,!0).forEach((function(t){Object(j.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):he(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var de=function(){var e=Object(a.useState)(0),t=Object(s.a)(e,2),n=t[0],r=(t[1],Object(a.useState)([])),o=Object(s.a)(r,2),c=o[0],l=o[1],h=Object(a.useState)(null),u=Object(s.a)(h,2),d=u[0],f=u[1],p=Object(a.useRef)(null),v=V({useCache:!1,query:{endpoint:"/api/location/historic"},refetch:n}),m=v.loading,g=v.data,w=v.error,b=function(){if(p.current){var e=p.current.getBoundingClientRect();f({width:e.width,height:e.height})}};return Object(a.useEffect)((function(){return p.current&&b(),window.addEventListener("resize",b),function(){return window.removeEventListener("resize",b)}}),[p.current]),Object(a.useEffect)((function(){g&&l(g)}),[g]),i.a.createElement("div",{ref:p,className:"movement-view"},d?i.a.createElement(i.a.Fragment,null,i.a.createElement(ae.Provider,{value:{data:c,appendData:function(e){0===c.length?l((function(t){return[].concat(Object(P.a)(t),[e])})):c[c.length-1].time<e.time&&l((function(t){return[].concat(Object(P.a)(t),[e])}))}}},i.a.createElement(le,{viewport:ue({},d,{width:d.width-250})}),m?i.a.createElement($,{size:{width:250,height:"100%"}}):w?i.a.createElement(te,{error:{title:"Something bad happened.",message:"We can't get location data at the moment. Please try later."},size:{width:250,height:"100%"}}):g?i.a.createElement(ie,null):null)):null)},fe=function(){var e=Object(a.useContext)(v).currentOption,t=null;switch(e){case"Dashboard":t=i.a.createElement(w,null);break;case d:case f:case p:t=i.a.createElement(ne,{key:e,currentOption:e});break;case"Movement":t=i.a.createElement(de,null);break;default:t=i.a.createElement("div",{className:"not-implemented"},i.a.createElement("h1",null,"404"),i.a.createElement("p",null,"Not implemented yet. Coming soon. "))}return i.a.createElement("div",{className:"switch"},t)},pe=function(){return i.a.createElement("div",{className:"dashboard"},i.a.createElement(g,null),i.a.createElement(fe,null))},ve=function(){var e=Object(a.useState)("Movement"),t=Object(s.a)(e,2),n=t[0],r=t[1];return i.a.createElement(v.Provider,{value:{currentOption:n,setCurrentOption:function(e){r(e)}}},i.a.createElement(pe,null))};o.a.render(i.a.createElement(ve,null),document.getElementById("root"))}},[[32,1,2]]]);
//# sourceMappingURL=main.ec310f55.chunk.js.map