(this.webpackJsonpwebapp=this.webpackJsonpwebapp||[]).push([[0],{32:function(t,e,n){t.exports=n(45)},37:function(t,e,n){},45:function(t,e,n){"use strict";n.r(e);var i=n(2),a=n.n(i),r=n(22),o=n.n(r),s=n(5),c=(n(37),n(14)),l=n(15),h=n(10),d=n(23),u="Temperature",f="Moisture",p="Light",m=a.a.createContext({currentOption:"Dashboard",setCurrentOption:function(t){throw new Error("setCurrentOption() not implemented.")}}),v=[{name:"Dashboard",indented:!1,icon:a.a.createElement(c.a,{size:20,color:"white"})},{name:u,indented:!0,icon:a.a.createElement(l.a,{size:20,color:"white"})},{name:f,indented:!0,icon:a.a.createElement(h.c,{size:20,color:"white"})},{name:p,indented:!0,icon:a.a.createElement(d.a,{size:20,color:"white"})},{name:"Movement",indented:!0,icon:a.a.createElement(c.b,{size:20,color:"white"})},{name:"Twitter",indented:!1,icon:a.a.createElement(l.b,{size:20,color:"white"})},{name:"Settings",indented:!1,icon:a.a.createElement(c.c,{size:20,color:"white"})}],g=function(){var t=Object(i.useContext)(m),e=t.currentOption,n=t.setCurrentOption;return a.a.createElement("div",{className:"menu"},v.map((function(t){return a.a.createElement("div",{key:t.name,className:"item  ".concat(t.name===e?"selected":""),onClick:function(){e!==t.name&&n(t.name)}},a.a.createElement("div",{className:"icon ".concat(t.indented?"indent":"")},t.icon),a.a.createElement("div",{className:"text"},t.name))})))},w=n(6),b=n.n(w),y=n(11),O=n(3),j=n(4);function E(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function D(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?E(n,!0).forEach((function(e){Object(O.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):E(n).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var x,k=function(t){var e=t.live,n=t.setLive,i=t.setTimePeriod,r=t.shouldRenderLive,o=t.conf;return a.a.createElement("div",{className:"control-pane"},e?a.a.createElement("div",null):a.a.createElement("div",{className:"".concat(o.name," time-button-group")},o.timePeriod.map((function(t){return a.a.createElement("div",{key:t.timePeriod,className:"time-button ".concat(t.selected?"selected":""),onClick:function(){t.selected||i(o.timePeriod.map((function(e){return D({},e,e===t?{selected:!e.selected}:{selected:!1})})))}},"".concat(t.timePeriod,"m"))}))),r?a.a.createElement("button",{className:"".concat(o.name," ").concat(e?"live":""),onClick:n},"Live"):null)},S=n(8),P=n(9),L=n(24),z=(x={},Object(O.a)(x,u,["#FF3D3D","#ff7521","#ffa500"]),Object(O.a)(x,f,["#125D92","#3AD8FC","#88F9FE"]),Object(O.a)(x,p,["#EFEFEF","#D1D1D1","#574A4B"]),x);var M={drawGradient:function(t,e,n){for(var i=[],a=z[n],r=0;r<a.length;r++)0===r?i.push({offset:"0%",color:a[r]}):i.push({offset:"".concat(100/(a.length-r),"%"),color:a[r]});var o=t.select("#linegradient");o.empty()&&(o=t.append("defs").append("linearGradient").attr("id","linegradient").attr("gradientUnits","userSpaceOnUse")),o.attr("x1",e.width/2).attr("y1",0).attr("x2",e.width/2).attr("y2",e.height).selectAll("stop").data(i).enter().append("stop").attr("offset",(function(t){return t.offset})).attr("stop-color",(function(t){return t.color}))}};function A(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}var C=["#ffa500","#ff2929","#7a7aed"],N=function(){function t(e){if(Object(P.a)(this,t),this.svgHTML=void 0,this.svg=void 0,this.viewport=void 0,this.margin=void 0,this.data=void 0,this.liveData=void 0,this.xScale=void 0,this.yScale=void 0,this.conf=void 0,this.tooltip=void 0,this.line=void 0,this.xAxis=void 0,this.yAxis=void 0,this.clip=void 0,this.dashedLines=void 0,this.live=void 0,this.legend=void 0,this.title=void 0,this.live=!1,this.svgHTML=e.svg,this.margin=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?A(n,!0).forEach((function(e){Object(O.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):A(n).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({top:40,bottom:40,left:40,right:40},e.conf.margin||{}),this.viewport={width:e.viewport.width-this.margin.left-this.margin.right,height:e.viewport.height-this.margin.top-this.margin.bottom},this.svg=j.j(e.svg).append("g").attr("transform","translate(".concat(this.margin.left,", ").concat(this.margin.top,")")),this.conf=e.conf,this.data=this.scaleData(e.data),this.liveData=[],this.getXScale(this.data),this.getYScale(this.data),this.tooltip=j.j(this.svgHTML.parentNode).append("div").attr("class","tooltip"),this.legend=j.j(e.svg).append("foreignObject").attr("width",this.margin.right).attr("height","50%").attr("transform","translate(".concat(this.viewport.width+this.margin.left,", ").concat(this.viewport.height/2,")")).append("xhtml:div").classed("svg-legend",!0),this.data instanceof Array)this.line=this.svg.append("path").attr("class","line").attr("stroke",this.conf.name===u||this.conf.name===f||this.conf.name===p?"url(#line-gradient)":C[0]);else if("object"===typeof this.data){var n=Object.keys(this.data);this.line=[];for(var i=0;i<n.length;i++)this.legend.append("div").classed("legend",!0).append("div").classed("legend-item",!0).style("border-left","15px solid ".concat(C[i])).text("Zone "+(i+1)),this.line.push(this.svg.append("path").attr("class","line").attr("stroke",C[i]))}console.log(this.viewport),this.title=this.svg.append("text").text(this.conf.title||"").attr("x",this.viewport.width/2).attr("y",-this.margin.top/2).attr("stroke",z[this.conf.name][1]).attr("font-size","20px"),this.clip=this.svg.append("g").attr("class","clip").append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",this.viewport.width).attr("height",this.viewport.height),this.xAxis=j.j(this.svgHTML).append("g").attr("class","x-axis"),this.yAxis=j.j(this.svgHTML).append("g").attr("class","y-axis").attr("transform","translate(".concat(this.margin.left,", ").concat(this.margin.top,")")),this.dashedLines=this.svg.append("g").classed("dashed-line-g",!0),this.conf.name!==u&&this.conf.name!==f&&this.conf.name!==p||M.drawGradient(this.svg,this.viewport,this.conf.name)}return Object(L.a)(t,[{key:"setConf",value:function(t,e){this.conf=t,this.data=this.scaleData(e),this.getXScale(this.data),this.getYScale(this.data),this.plot("update")}},{key:"scaleData",value:function(t){var e=this.conf.timePeriod;if(5!==e.timePeriod){var n=e.timePeriod/5;return this.computeData(t,n)}if(t instanceof Array)return Object(S.a)(t);if("object"===typeof t){var i={};for(var a in t)i[a]=Object(S.a)(t[a]);return i}return t}},{key:"computeData",value:function(t,e){if(t instanceof Array){for(var n=[],i=Math.ceil(t.length/e),a=0;a<i-1;a++){for(var r=0,o=0,s=0;s<e;s++){var c=a*e+s;r=0===s?t[c].value:(r+t[c].value)/2,0===s&&(o=t[c].time)}n.push({time:o,value:r})}return[].concat(n)}if("object"===typeof t){var l={};for(var h in t){for(var d=t[h],u=[],f=Math.ceil(d.length/e),p=0;p<f-1;p++){for(var m=0,v=0,g=0;g<e;g++){var w=p*e+g;m=0===g?d[w].value:(m+d[w].value)/2,0===g&&(v=d[w].time)}u.push({time:v,value:m})}l[h]=u}return l}return t}},{key:"setViewport",value:function(t){j.j(this.svgHTML).attr("width",t.width).attr("height",t.height),this.viewport={width:t.width-this.margin.left-this.margin.right,height:t.height-this.margin.top-this.margin.bottom},this.resize()}},{key:"setData",value:function(t){this.data=t,this.resize()}},{key:"goLive",value:function(){this.live=!0,this.dashedLines.html(""),this.xAxis.html(""),this.yAxis.html(""),this.line.remove(),this.line=this.svg.append("path").attr("clip-path","url(#clip)").attr("class","line").attr("stroke",this.conf.name===u||this.conf.name===f||this.conf.name===p?"url(#line-gradient)":C[0]),this.liveData=[],j.j(this.svgHTML).on("mousemove",null),j.j(this.svgHTML).on("mouseleave",null)}},{key:"addLiveData",value:function(t){this.liveData.push(t),this.plotLive()}},{key:"plotLive",value:function(){var t=this;if(this.liveData.length>2){this.getYScale(this.liveData.slice(1,this.liveData.length-1));var e=j.b(this.yScale).ticks(Math.floor(this.viewport.height/20));this.yAxis.transition().duration(400).call(e),this.getXScale(this.liveData);var n=j.a(this.xScale).ticks(Math.floor(this.viewport.height/40));this.xAxis.transition().duration(400).call(n);var i=j.g().x((function(e){return t.xScale(new Date(e.time))})).y((function(e){return t.yScale(e.value)})).curve(j.c);this.line.datum(this.liveData.slice(1)).attr("d",i).style("transform",null).transition().duration(300).attr("stroke",this.conf.name===u||this.conf.name===f||this.conf.name===p?"url(#linegradient)":C[0]).style("transform","translate(".concat(function(){return this.liveData.length>=90?this.xScale(this.liveData[0].time)-this.xScale(this.liveData[1].time):0}.bind(this)(),"px, 0)")),this.liveData.length>=30&&this.liveData.shift()}}},{key:"goHistory",value:function(){this.live=!1,this.getXScale(this.data),this.getYScale(this.data),this.line.remove(),this.line=this.svg.append("path").attr("class","line").attr("stroke",this.conf.name===u||this.conf.name===f||this.conf.name===p?"url(#line-gradient)":C[0]),this.plot("start")}},{key:"showTip",value:function(){var t=j.e,e=t.offsetX,n=t.offsetY,i=this.svg.select("circle");if(e>this.margin.left&&e<this.viewport.width+this.margin.left&&n>this.margin.top&&n<this.viewport.height+this.margin.top){var a=this.xScale.invert(e-this.margin.left);if(this.data instanceof Array){var r=this.data.findIndex((function(t){return t.time>a})),o=this.xScale(this.data[r].time);i.empty()?this.svg.append("circle").attr("cx",o).attr("cy",this.yScale(this.data[r].value)).attr("r",5).attr("fill","none").attr("stroke","white"):(i.attr("cx",this.xScale(this.data[r].time)).attr("cy",this.yScale(this.data[r].value)),this.tooltip.html("<p>".concat(new Date(this.data[r].time).toLocaleString(),"</p><p>Value: ").concat(this.data[r].value.toFixed(2),"</p>")).classed("show",!0).style("top",Math.floor(this.yScale(this.data[r].value)+this.margin.top-3)+"px").style("left",Math.floor(o+this.margin.left+5)+"px").style("margin-left",o>this.viewport.width/2?"-130px":"0px"))}}else i.empty()||i.remove(),this.tooltip.classed("show",!1)}},{key:"plot",value:function(t){var e=this;this.data instanceof Array&&this.data.length>1&&(j.j(this.svgHTML).on("mousemove",(function(){return e.showTip()})),j.j(this.svgHTML).on("mouseleave",(function(){e.svg.select("circle").remove(),e.tooltip.classed("show",!1)})));var n=j.k().duration(500).ease(j.d),i=j.g().x((function(t){return e.xScale(new Date(t.time))})).y((function(t){return e.yScale(t.value)})).curve(j.c),a=j.a(this.xScale).ticks(Math.floor(this.viewport.width/60));this.xAxis.attr("transform","translate(".concat(this.margin.left,", ").concat(this.viewport.height+this.margin.top,")")).call(a);var r=j.b(this.yScale).ticks(Math.floor(this.viewport.height/20));if(this.yAxis.call(r),this.dashedLines.html(""),r.scale().ticks(Math.floor(this.viewport.height/20)).forEach((function(t){e.dashedLines.append("line").classed("dashed-line",!0).attr("x1",0).attr("y1",e.yScale(t)).attr("x2",e.viewport.width).attr("y2",e.yScale(t))})),this.data instanceof Array)this.line.datum(this.data).attr("d",i).attr("stroke",this.conf.name===u||this.conf.name===f||this.conf.name===p?"url(#linegradient)":C[0]),"update"===t&&this.line.attr("stroke-dasharray",this.line.node().getTotalLength()+" "+this.line.node().getTotalLength()).attr("stroke-dashoffset",this.line.node().getTotalLength()).transition().duration(700).attr("stroke-dashoffset",0),"start"===t&&this.svg.attr("opacity",0).transition(n).attr("opacity",1),this.svg.selectAll(".dot");else if("object"===typeof this.data){var o=0;for(var s in this.data)this.line[o].datum(this.data[s]).attr("d",i),"update"===t&&this.line[o].attr("stroke-dasharray",this.line[o].node().getTotalLength()+" "+this.line[o].node().getTotalLength()).attr("stroke-dashoffset",this.line[o].node().getTotalLength()).transition().duration(700).attr("stroke-dashoffset",0),"start"===t&&this.svg.attr("opacity",0).transition(n).attr("opacity",1),this.svg.selectAll(".dot"),o++}}},{key:"clean",value:function(){delete this.svg,delete this.svgHTML,delete this.viewport,delete this.margin,delete this.data,delete this.liveData,delete this.yScale,delete this.xScale,delete this.conf,delete this.tooltip,delete this.line,delete this.xAxis,delete this.yAxis,delete this.clip,delete this.dashedLines}},{key:"resize",value:function(){this.conf.name!==u&&this.conf.name!==f&&this.conf.name!==p||M.drawGradient(this.svg,this.viewport,this.conf.name),this.title.attr("x",this.viewport.width/2).attr("y",-this.margin.top/2),this.clip.attr("width",this.viewport.width).attr("height",this.viewport.height),0!==this.liveData.length?(console.log(this.liveData),this.getXScale(this.liveData),this.getYScale(this.liveData),this.plotLive()):this.live||(this.getXScale(this.data),this.getYScale(this.data),this.plot())}},{key:"getXScale",value:function(t){if(t instanceof Array)this.xScale=j.i().domain([new Date(t[0].time),new Date(t[t.length-1].time)]).range([0,this.viewport.width]);else if("object"===typeof t){var e=[];for(var n in t){var i;(i=e).push.apply(i,Object(S.a)(j.f(t[n],(function(t){return t.time}))))}e=j.f(e),this.xScale=j.i().domain([new Date(e[0]),new Date(e[1])]).range([0,this.viewport.width])}}},{key:"getYScale",value:function(t){if(t instanceof Array)this.yScale=j.h().domain(j.f(t,(function(t){return t.value}))).range([this.viewport.height,0]);else if("object"===typeof t){var e=[];for(var n in t)e.push.apply(e,Object(S.a)(j.f(t[n],(function(t){return t.value}))));this.yScale=j.h().domain(j.f(e)).range([this.viewport.height,0])}}}]),t}();function T(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function F(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?T(n,!0).forEach((function(e){Object(O.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):T(n).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var H=function(t){var e=t.viewport,n=t.data,r=t.conf,o=t.control,c=void 0===o?{shouldRenderLive:!0}:o,l=Object(i.useRef)(null),h=Object(i.useState)(!1),d=Object(s.a)(h,2),u=d[0],f=d[1],p=Object(i.useState)([{timePeriod:5,selected:!0},{timePeriod:15,selected:!1},{timePeriod:30,selected:!1}]),m=Object(s.a)(p,2),v=m[0],g=m[1],w=Object(i.useState)(null),O=Object(s.a)(w,2),E=O[0],D=O[1];return Object(i.useEffect)((function(){n&&E&&l.current&&E.setData(n)}),[n,E]),Object(i.useEffect)((function(){E&&E.setConf(F({},r,{timePeriod:v.filter((function(t){return t.selected}))[0]}),n)}),[v]),Object(i.useEffect)((function(){E&&E.plot("start")}),[E]),Object(i.useEffect)((function(){return function(){var t=document.getElementById(r.id);t&&l.current&&l.current.removeChild(t)}}),[]),Object(i.useEffect)((function(){if(l.current){var t=l.current;if(1===t.childNodes.length){j.j(t).append("svg").attr("id",r.id).attr("width",e.width).attr("height",e.height);var i=document.getElementById(r.id);if(i){var a=new N({svg:i,viewport:e,data:n,conf:F({},r,{timePeriod:v.filter((function(t){return t.selected}))[0]})});D(a)}return function(){E&&E.clean()}}}}),[l.current]),Object(i.useEffect)((function(){if(l.current){var t=document.getElementById(r.id);if(t){var n=t.getBoundingClientRect();n.height===e.height&&n.width===e.width||E&&E.setViewport(e)}}}),[e]),Object(i.useEffect)((function(){if(E&&u){E.goLive();var t=setInterval(Object(y.a)(b.a.mark((function t(){var e,n;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("https://dowav-api.herokuapp.com/api/live/".concat(r.name));case 2:return e=t.sent,t.next=5,e.json();case 5:n=t.sent,r.zone?E.addLiveData(n[r.zone-1]):console.error("Please specify zone for Graphh with name "+r.name);case 7:case"end":return t.stop()}}),t)}))),2e3);return function(){clearInterval(t)}}}),[E,u]),a.a.createElement("div",{className:"graph ".concat(r.name," ").concat(u?"live":"")},a.a.createElement("div",{ref:l},a.a.createElement(k,{shouldRenderLive:c.shouldRenderLive,live:u,setLive:function(){u&&E&&E.goHistory(),f(!u)},setTimePeriod:g,conf:F({},r,{timePeriod:v})})))},I=n(12),R=n.n(I),B={timeout:{title:"Error",message:"Looks like the server is taking to long to respond, please try again in sometime.",actions:["refetch"]},fetchFail:{title:"Error",message:"We can't get data right now. Try a little bit later",actions:["refetch"]},noData:{title:"No Data.",message:"Seems like there is no data available at the moment.",actions:["refetch"]}},G={hostname:"https://dowav-api.herokuapp.com"};function q(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function Y(t){var e=window.localStorage.getItem(t+"lastFetched");if(e&&R()(+e).isAfter(R()().add(-5,"minutes"))){var n=window.localStorage.getItem(t);if(n)return JSON.parse(n)}return null}function Z(t){if(void 0===t)return"";var e=Object.keys(t);if(0===e.length)return"";for(var n="?",i=0;i<e.length;i++)n+="".concat(e[i],"=").concat(t[e[i]]).concat(i===e.length-1?"":"&");return n}function X(t){var e=t.useCache?Y(t.query.endpoint):null,n=Object(i.useState)({loading:!e,data:e||null,error:null}),a=Object(s.a)(n,2),r=a[0],o=a[1];function c(){console.log("useFetc",r),new Promise(function(){var e=Object(y.a)(b.a.mark((function e(n,i){var a,r,o,s;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Date.now(),r=setTimeout((function(){i(B.timeout)}),1e4),e.prev=2,e.next=5,fetch("".concat(G.hostname).concat(t.query.endpoint).concat(Z(t.query.params)));case 5:return o=e.sent,e.next=8,o.json();case 8:s=e.sent,console.log(s),clearTimeout(r),null===s&&i(B.noData),t.useCache&&(window.localStorage.setItem(t.query.endpoint,JSON.stringify(s)),window.localStorage.setItem(t.query.endpoint+"lastFetched",Date.now()+"")),Date.now()-a>500?n(s):setTimeout((function(){n(s)}),Date.now()-a),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(2),i(B.fetchFail);case 19:case"end":return e.stop()}}),e,null,[[2,16]])})));return function(t,n){return e.apply(this,arguments)}}()).then((function(t){o({loading:!1,data:t,error:null})})).catch((function(t){o({loading:!1,error:t,data:null})}))}return Object(i.useEffect)((function(){if(0!==t.refetch)if(t.useCache){var e=Y(t.query.endpoint);e?o({loading:!1,data:e,error:null}):(o({loading:!0,data:null,error:null}),c())}else o({loading:!0,data:null,error:null}),c()}),[t.refetch]),Object(i.useEffect)((function(){e||c()}),[]),function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?q(n,!0).forEach((function(e){Object(O.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):q(n).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},r)}var V=n(16),J=n(17);function Q(){var t=Object(V.a)(["\n  cx: 50%;\n  cy: 50%;\n  r: 50;\n  fill: none;\n  stroke-width: 10px;\n  stroke-dasharray: 160;\n  transform-origin: 50% 50%;\n  animation: "," 2s ease infinite;\n"]);return Q=function(){return t},t}function U(){var t=Object(V.a)(["\n    0%{\n        stroke-dashoffset: 290;\n    }\n    50%{\n        stroke-dashoffset: 50;\n    }\n    100%{\n        stroke-dashoffset: 290;\n    }\n"]);return U=function(){return t},t}var W=Object(J.b)(U()),K=J.a.circle(Q(),W),$=function(t){var e=t.size,n=t.currentOption,i=void 0===n?p:n;return a.a.createElement("svg",{stroke:z[i][1],width:e.width,height:e.height,className:"loader"},a.a.createElement(K,null))};function _(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function tt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?_(n,!0).forEach((function(e){Object(O.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):_(n).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var et=function(t){var e=t.error,n=t.onRefetch,i=void 0===n?function(){return console.warn("You haven't passed a fucntion")}:n,r=t.size,o=void 0===r?{width:"100%",height:"100%"}:r;return a.a.createElement("div",{className:"error-box",style:tt({},o)},a.a.createElement("h1",null,e.title),a.a.createElement("p",null,e.message),e&&e.actions&&e.actions.includes("refetch")?a.a.createElement("div",null,a.a.createElement(h.b,{size:"40",color:"white",className:"refetch-icon",onClick:i})):null)},nt=function(t){var e=t.currentOption,n=Object(i.useState)(0),r=Object(s.a)(n,2),o=r[0],c=r[1],l=Object(i.useState)(null),h=Object(s.a)(l,2),d=h[0],u=h[1],f=Object(i.useRef)(null),p=X({useCache:!0,query:{endpoint:"/api/historic/".concat(e.toLowerCase()),params:{from:1,to:Math.floor(Date.now()/1e3)}},refetch:o}),m=p.loading,v=p.data,g=p.error,w=function(){if(f.current){var t=f.current.getBoundingClientRect();u({width:t.width,height:t.height})}};return Object(i.useEffect)((function(){return f.current&&w(),window.addEventListener("resize",w),function(){return window.removeEventListener("resize",w)}}),[f.current]),a.a.createElement("div",{ref:f,className:"graph-view"},d?a.a.createElement(a.a.Fragment,null,m?a.a.createElement($,{size:d,currentOption:e}):g?a.a.createElement("div",{className:"error-message"},a.a.createElement(et,{error:g,onRefetch:function(){c(o+1)}})):a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:"graph-view-row"},v[0]instanceof Array&&v[0].length>0?a.a.createElement(H,{data:v[0],viewport:{width:(d.width-50)/3,height:(d.height-100)/2},conf:{title:"Zone 1",name:e,id:e+1,zone:1}}):a.a.createElement(et,{error:{title:"No data.",message:"It seems like there is no data at the moment."},size:{width:(d.width-50)/3,height:d.height/2}}),v[1]instanceof Array&&v[1].length>0?a.a.createElement(H,{data:v[1],viewport:{width:(d.width-50)/3,height:(d.height-100)/2},conf:{title:"Zone 2",name:e,id:e+2,zone:2}}):a.a.createElement(et,{error:{title:"No data.",message:"It seems like there is no data at the moment."},size:{width:(d.width-50)/3,height:d.height/2}}),v[2]instanceof Array&&v[2].length>0?a.a.createElement(H,{data:v[2],viewport:{width:(d.width-50)/3,height:(d.height-100)/2},conf:{title:"Zone 3",name:e,id:e+3,zone:3}}):a.a.createElement(et,{error:{title:"No data.",message:"It seems like there is no data at the moment."},size:{width:(d.width-50)/3,height:d.height/2}})),a.a.createElement("div",{className:"graph-view-row"},v.every((function(t){return t}))?a.a.createElement(H,{data:{zoneA:v[0],zoneB:v[1],zoneC:v[2]},control:{shouldRenderLive:!1},viewport:{width:d.width-10,height:(d.height-100)/2},conf:{margin:{top:40,left:40,right:120,bottom:40},title:"All Zones",name:e,id:e+4}}):null))):null)},it=a.a.createContext({data:[],appendData:function(t){throw new Error("appenData() not implemented.")}}),at=function(){var t=Object(i.useContext)(it).data;return a.a.createElement("div",{className:"history-list"},a.a.createElement("h1",null,"History"),a.a.createElement("h4",null,"Last 24 hours"),a.a.createElement("div",{className:"historic-item-list"},t.map((function(t,e){if(0===t.value)return a.a.createElement("div",{key:t.time+" - "+e,className:"historic-item",style:{background:"rgb(120, 120, 120)"}},"".concat(R()(t.time).format("D MMM HH:mm:ss")," - No Location\n        "));var n=255-30*(t.value-1);return a.a.createElement("div",{key:t.time+" - "+e,className:"historic-item",style:{background:"rgb(".concat(n,", ").concat(n,", ").concat(n,")")}},"".concat(R()(t.time).format("D MMM HH:mm:ss")," - Zone ").concat(t.value))}))))},rt=n(1),ot=n(27),st=n(28),ct=function t(e){var n=this;Object(P.a)(this,t),this.scene=void 0,this.camera=void 0,this.renderer=void 0,this.controls=void 0,this.cube=void 0,this.locationData=void 0,this.labModelLoaded=void 0,this.createBox=function(){var t=new rt.c(10.2,2.5,4.5333),e=[new rt.G({color:2794705,transparent:!0,opacity:.65,side:rt.i}),new rt.G({color:2794705,transparent:!0,opacity:.7,side:rt.i}),new rt.G({color:2794705,transparent:!0,opacity:.66,side:rt.i}),new rt.G({color:2794705,transparent:!0,opacity:.67,side:rt.i}),new rt.G({color:2794705,transparent:!0,opacity:.68,side:rt.i}),new rt.G({color:2794705,transparent:!0,opacity:.69,side:rt.i})],n=new rt.F(t,e);return n.position.set(-14,10,-1e4),n},this.updateViewport=function(t){n.camera.aspect=t.width/t.height,n.camera.updateProjectionMatrix(),n.renderer.setSize(t.width,t.height)},this.highlightZone=function(){n.locationData&&n.cube.position.set(0,1.4,4.53*(n.locationData.value-1)-4.53)},this.addLocationData=function(t){0!==t.value?(n.locationData=t,n.highlightZone()):n.scene.remove(n.cube)},this.animate=function(){requestAnimationFrame(n.animate),n.labModelLoaded&&(n.scene.remove(n.cube),n.scene.add(n.cube)),n.controls.update(),n.renderer.render(n.scene,n.camera)},this.scene=new rt.Z,this.locationData=null,this.camera=new rt.P(75,e.viewport.width/e.viewport.height,.1,1e3),this.camera.position.set(-14,10,-9),this.camera.lookAt(0,0,0),this.controls=new st.a(this.camera,e.container),this.controls.minDistance=3,this.controls.maxDistance=60,this.controls.maxPolarAngle=Math.PI/2.1,this.renderer=new rt.pb({alpha:!0}),this.renderer.setClearColor(0,0),this.renderer.setSize(e.viewport.width,e.viewport.height),e.container.appendChild(this.renderer.domElement),this.labModelLoaded=!1;var i=new rt.Q(16777215,1.6,0);i.position.set(0,40,0),this.scene.add(i);var a=new rt.Q(16777215,.8,0);a.position.set(-20,12,-25),this.scene.add(a);var r=new rt.Q(16777215,.8,0);r.position.set(18,12,18),this.scene.add(r),this.cube=this.createBox(),(new ot.a).load("".concat("","/labmodel.glb"),(function(t){n.labModelLoaded=!0,n.scene.add(t.scene),n.controls.update()}),(function(t){console.log("".concat(t.loaded/t.total*100,"% loaded"))}),(function(t){console.log("ERROR. Can't load the model"),console.log(t)})),requestAnimationFrame(this.animate),this.animate()},lt=function(t){var e=t.viewport,n=Object(i.useRef)(null),r=Object(i.useState)(null),o=Object(s.a)(r,2),c=o[0],l=o[1],h=Object(i.useContext)(it),d=h.data,u=h.appendData;return Object(i.useEffect)((function(){n.current&&!c&&(console.log("Creating new lab"),l(new ct({viewport:e,container:n.current})))}),[n.current]),Object(i.useEffect)((function(){c&&c.updateViewport(e)}),[e]),Object(i.useEffect)((function(){if(d.length>0&&c){var t=d[d.length-1];c.addLocationData(t);var e=setInterval(Object(y.a)(b.a.mark((function t(){var e,n;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch("https://dowav-api.herokuapp.com/api/location/live");case 3:return e=t.sent,t.next=6,e.json();case 6:n=t.sent,console.log(n),u(n),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(0),console.log(t.t0);case 14:case"end":return t.stop()}}),t,null,[[0,11]])}))),500);return function(){clearInterval(e)}}}),[d,c]),a.a.createElement("div",{ref:n,style:{width:e.width,height:e.height,outline:"none"}})};function ht(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function dt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ht(n,!0).forEach((function(e){Object(O.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ht(n).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var ut=function(){var t=Object(i.useState)(0),e=Object(s.a)(t,2),n=e[0],r=(e[1],Object(i.useState)([])),o=Object(s.a)(r,2),c=o[0],l=o[1],h=Object(i.useState)(null),d=Object(s.a)(h,2),u=d[0],f=d[1],p=Object(i.useRef)(null),m=X({useCache:!1,query:{endpoint:"/api/location/historic"},refetch:n}),v=m.loading,g=m.data,w=m.error,b=function(){if(p.current){var t=p.current.getBoundingClientRect();f({width:t.width,height:t.height})}};return Object(i.useEffect)((function(){return p.current&&b(),window.addEventListener("resize",b),function(){return window.removeEventListener("resize",b)}}),[p.current]),Object(i.useEffect)((function(){g&&l(g)}),[g]),a.a.createElement("div",{ref:p,className:"movement-view"},u?a.a.createElement(a.a.Fragment,null,a.a.createElement(it.Provider,{value:{data:c,appendData:function(t){0===c.length?l((function(e){return[].concat(Object(S.a)(e),[t])})):c[c.length-1].time<t.time&&l((function(e){return[].concat(Object(S.a)(e),[t])}))}}},a.a.createElement(lt,{viewport:dt({},u,{width:u.width-250})}),v?a.a.createElement($,{size:{width:250,height:"100%"}}):w?a.a.createElement(et,{error:{title:"Something bad happened.",message:"We can't get location data at the moment. Please try later."},size:{width:250,height:"100%"}}):g?a.a.createElement(at,null):null)):null)},ft=function(){var t=Object(i.useContext)(m).currentOption,e=null;switch(t){case u:case f:case p:e=a.a.createElement(nt,{key:t,currentOption:t});break;case"Movement":e=a.a.createElement(ut,null);break;default:e=a.a.createElement("div",{className:"not-implemented"},a.a.createElement("h1",null,"This page is under construction"),a.a.createElement(h.a,{size:180}))}return a.a.createElement("div",{className:"switch"},e)},pt=function(){return a.a.createElement("div",{className:"dashboard"},a.a.createElement(g,null),a.a.createElement(ft,null))},mt=function(){var t=Object(i.useState)(u),e=Object(s.a)(t,2),n=e[0],r=e[1];return a.a.createElement(m.Provider,{value:{currentOption:n,setCurrentOption:function(t){r(t)}}},a.a.createElement(pt,null))};o.a.render(a.a.createElement(mt,null),document.getElementById("root"))}},[[32,1,2]]]);
//# sourceMappingURL=main.46723ff7.chunk.js.map