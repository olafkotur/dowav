(this.webpackJsonpwebapp=this.webpackJsonpwebapp||[]).push([[0],{36:function(e,t,a){e.exports=a(51)},41:function(e,t,a){},51:function(e,t,a){"use strict";a.r(t);var n=a(1),i=a.n(n),r=a(13),o=a.n(r),s=a(6),c=(a(41),a(24)),l=a(17),h=a(18),u=a(14),d=a(27),f="Temperature",m="Moisture",p="Light",v=i.a.createContext({currentOption:"Dashboard",setCurrentOption:function(e){throw new Error("setCurrentOption() not implemented.")}}),g=[{name:"Dashboard",indented:!1,icon:i.a.createElement(l.a,{size:20,color:"white"})},{name:f,indented:!0,icon:i.a.createElement(h.a,{size:20,color:"white"})},{name:m,indented:!0,icon:i.a.createElement(u.c,{size:20,color:"white"})},{name:p,indented:!0,icon:i.a.createElement(d.a,{size:20,color:"white"})},{name:"Movement",indented:!0,icon:i.a.createElement(l.b,{size:20,color:"white"})},{name:"Twitter",indented:!1,icon:i.a.createElement(h.b,{size:20,color:"white"})},{name:"Settings",indented:!1,icon:i.a.createElement(l.c,{size:20,color:"white"})}],w=function(){var e=Object(n.useContext)(v),t=e.currentOption,a=e.setCurrentOption;return i.a.createElement("div",{className:"menu"},g.map((function(e){return i.a.createElement("div",{key:e.name,className:"item  ".concat(e.name===t?"selected":""),onClick:function(){t!==e.name&&a(e.name)}},i.a.createElement("div",{className:"icon ".concat(e.indented?"indent":"")},e.icon),i.a.createElement("div",{className:"text"},e.name))})))},b=a(7),y=a.n(b),O=a(9),j=a(4),E=a(5);function x(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function D(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?x(a,!0).forEach((function(t){Object(j.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):x(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var k,S=function(e){var t=e.live,a=e.setLive,n=e.setTimePeriod,r=e.shouldRenderLive,o=e.conf;return i.a.createElement("div",{className:"control-pane"},t?i.a.createElement("div",null):i.a.createElement("div",{className:"".concat(o.name," time-button-group")},o.timePeriod.map((function(e){return i.a.createElement("div",{key:e.timePeriod,className:"time-button ".concat(e.selected?"selected":""),onClick:function(){e.selected||n(o.timePeriod.map((function(t){return D({},t,t===e?{selected:!t.selected}:{selected:!1})})))}},"".concat(e.timePeriod,"m"))}))),r?i.a.createElement("button",{className:"".concat(o.name," ").concat(t?"live":""),onClick:a},"Live"):null)},P=a(11),L=a(12),N=a(28),A=(k={},Object(j.a)(k,f,["#FF3D3D","#ff7521","#ffa500"]),Object(j.a)(k,m,["#125D92","#3AD8FC","#88F9FE"]),Object(j.a)(k,p,["#EFEFEF","#D1D1D1","#574A4B"]),k);var z={drawGradient:function(e,t,a){for(var n=[],i=A[a],r=0;r<i.length;r++)0===r?n.push({offset:"0%",color:i[r]}):n.push({offset:"".concat(100/(i.length-r),"%"),color:i[r]});var o=e.select("#linegradient");o.empty()&&(o=e.append("defs").append("linearGradient").attr("id","linegradient").attr("gradientUnits","userSpaceOnUse")),o.attr("x1",t.width/2).attr("y1",0).attr("x2",t.width/2).attr("y2",t.height).selectAll("stop").data(n).enter().append("stop").attr("offset",(function(e){return e.offset})).attr("stop-color",(function(e){return e.color}))}};function C(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}var T=["#ffa500","#ff2929","#7a7aed"],M=function(){function e(t){if(Object(L.a)(this,e),this.svgHTML=void 0,this.svg=void 0,this.viewport=void 0,this.margin=void 0,this.data=void 0,this.liveData=void 0,this.xScale=void 0,this.yScale=void 0,this.conf=void 0,this.tooltip=void 0,this.line=void 0,this.xAxis=void 0,this.yAxis=void 0,this.clip=void 0,this.dashedLines=void 0,this.live=void 0,this.legend=void 0,this.title=void 0,this.live=!1,this.svgHTML=t.svg,this.margin=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?C(a,!0).forEach((function(t){Object(j.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):C(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({top:40,bottom:40,left:40,right:40},t.conf.margin||{}),this.viewport={width:t.viewport.width-this.margin.left-this.margin.right,height:t.viewport.height-this.margin.top-this.margin.bottom},this.svg=E.j(t.svg).append("g").attr("transform","translate(".concat(this.margin.left,", ").concat(this.margin.top,")")),this.conf=t.conf,this.data=this.scaleData(t.data),this.liveData=[],this.getXScale(this.data),this.getYScale(this.data),this.tooltip=E.j(this.svgHTML.parentNode).append("div").attr("class","tooltip"),this.legend=E.j(t.svg).append("foreignObject").attr("width",this.margin.right).attr("height","50%").attr("transform","translate(".concat(this.viewport.width+this.margin.left,", ").concat(this.viewport.height/2,")")).append("xhtml:div").classed("svg-legend",!0),this.data instanceof Array)this.line=this.svg.append("path").attr("class","line").attr("stroke",this.conf.name===f||this.conf.name===m||this.conf.name===p?"url(#line-gradient)":T[0]);else if("object"===typeof this.data){var a=Object.keys(this.data);this.line=[];for(var n=0;n<a.length;n++)this.legend.append("div").classed("legend",!0).append("div").classed("legend-item",!0).style("border-left","15px solid ".concat(T[n])).text("Zone "+(n+1)),this.line.push(this.svg.append("path").attr("class","line").attr("stroke",T[n]))}this.title=this.svg.append("text").text(this.conf.title||"").attr("x",this.viewport.width/2).attr("y",-this.margin.top/2).attr("stroke",A[this.conf.name][1]).attr("font-size","20px"),this.clip=this.svg.append("g").attr("class","clip").append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",this.viewport.width).attr("height",this.viewport.height),this.xAxis=E.j(this.svgHTML).append("g").attr("class","x-axis"),this.yAxis=E.j(this.svgHTML).append("g").attr("class","y-axis").attr("transform","translate(".concat(this.margin.left,", ").concat(this.margin.top,")")),this.dashedLines=this.svg.append("g").classed("dashed-line-g",!0),this.conf.name!==f&&this.conf.name!==m&&this.conf.name!==p||z.drawGradient(this.svg,this.viewport,this.conf.name)}return Object(N.a)(e,[{key:"setConf",value:function(e,t){this.conf=e,this.data=this.scaleData(t),this.getXScale(this.data),this.getYScale(this.data),this.plot("update")}},{key:"scaleData",value:function(e){var t=this.conf.timePeriod;if(5!==t.timePeriod){var a=t.timePeriod/5;return this.computeData(e,a)}if(e instanceof Array)return Object(P.a)(e);if("object"===typeof e){var n={};for(var i in e)n[i]=Object(P.a)(e[i]);return n}return e}},{key:"computeData",value:function(e,t){if(e instanceof Array){for(var a=[],n=Math.ceil(e.length/t),i=0;i<n-1;i++){for(var r=0,o=0,s=0;s<t;s++){var c=i*t+s;r=0===s?e[c].value:(r+e[c].value)/2,0===s&&(o=e[c].time)}a.push({time:o,value:r})}return[].concat(a)}if("object"===typeof e){var l={};for(var h in e){for(var u=e[h],d=[],f=Math.ceil(u.length/t),m=0;m<f-1;m++){for(var p=0,v=0,g=0;g<t;g++){var w=m*t+g;p=0===g?u[w].value:(p+u[w].value)/2,0===g&&(v=u[w].time)}d.push({time:v,value:p})}l[h]=d}return l}return e}},{key:"setViewport",value:function(e){E.j(this.svgHTML).attr("width",e.width).attr("height",e.height),this.viewport={width:e.width-this.margin.left-this.margin.right,height:e.height-this.margin.top-this.margin.bottom},this.resize()}},{key:"setData",value:function(e){this.data=e,this.resize()}},{key:"goLive",value:function(){this.live=!0,this.dashedLines.html(""),this.xAxis.html(""),this.yAxis.html(""),this.line.remove(),this.line=this.svg.append("path").attr("clip-path","url(#clip)").attr("class","line").attr("stroke",this.conf.name===f||this.conf.name===m||this.conf.name===p?"url(#line-gradient)":T[0]),this.liveData=[],E.j(this.svgHTML).on("mousemove",null),E.j(this.svgHTML).on("mouseleave",null)}},{key:"addLiveData",value:function(e){this.liveData.push(e),this.plotLive()}},{key:"plotLive",value:function(){var e=this;if(this.liveData.length>2){this.getYScale(this.liveData.slice(1,this.liveData.length-1));var t=E.b(this.yScale).ticks(Math.floor(this.viewport.height/20));this.yAxis.transition().duration(400).call(t),this.getXScale(this.liveData);var a=E.a(this.xScale).ticks(Math.floor(this.viewport.height/40));this.xAxis.transition().duration(400).call(a);var n=E.g().x((function(t){return e.xScale(new Date(t.time))})).y((function(t){return e.yScale(t.value)})).curve(E.c);this.line.datum(this.liveData.slice(1)).attr("d",n).style("transform",null).transition().duration(300).attr("stroke",this.conf.name===f||this.conf.name===m||this.conf.name===p?"url(#linegradient)":T[0]).style("transform","translate(".concat(function(){return this.liveData.length>=90?this.xScale(this.liveData[0].time)-this.xScale(this.liveData[1].time):0}.bind(this)(),"px, 0)")),this.liveData.length>=30&&this.liveData.shift()}}},{key:"goHistory",value:function(){this.live=!1,this.getXScale(this.data),this.getYScale(this.data),this.line.remove(),this.line=this.svg.append("path").attr("class","line").attr("stroke",this.conf.name===f||this.conf.name===m||this.conf.name===p?"url(#line-gradient)":T[0]),this.plot("start")}},{key:"showTip",value:function(){var e=E.e,t=e.offsetX,a=e.offsetY,n=this.svg.select("circle");if(t>this.margin.left&&t<this.viewport.width+this.margin.left&&a>this.margin.top&&a<this.viewport.height+this.margin.top){var i=this.xScale.invert(t-this.margin.left);if(this.data instanceof Array){var r=this.data.findIndex((function(e){return e.time>i})),o=this.xScale(this.data[r].time);n.empty()?this.svg.append("circle").attr("cx",o).attr("cy",this.yScale(this.data[r].value)).attr("r",5).attr("fill","none").attr("stroke","white"):(n.attr("cx",this.xScale(this.data[r].time)).attr("cy",this.yScale(this.data[r].value)),this.tooltip.html("<p>".concat(new Date(this.data[r].time).toLocaleString(),"</p><p>Value: ").concat(this.data[r].value.toFixed(2),"</p>")).classed("show",!0).style("top",Math.floor(this.yScale(this.data[r].value)+this.margin.top-3)+"px").style("left",Math.floor(o+this.margin.left+5)+"px").style("margin-left",o>this.viewport.width/2?"-130px":"0px"))}}else n.empty()||n.remove(),this.tooltip.classed("show",!1)}},{key:"plot",value:function(e){var t=this;this.data instanceof Array&&this.data.length>1&&(E.j(this.svgHTML).on("mousemove",(function(){return t.showTip()})),E.j(this.svgHTML).on("mouseleave",(function(){t.svg.select("circle").remove(),t.tooltip.classed("show",!1)})));var a=E.k().duration(500).ease(E.d),n=E.g().x((function(e){return t.xScale(new Date(e.time))})).y((function(e){return t.yScale(e.value)})).curve(E.c),i=E.a(this.xScale).ticks(Math.floor(this.viewport.width/60));this.xAxis.attr("transform","translate(".concat(this.margin.left,", ").concat(this.viewport.height+this.margin.top,")")).call(i);var r=E.b(this.yScale).ticks(Math.floor(this.viewport.height/20));if(this.yAxis.call(r),this.dashedLines.html(""),r.scale().ticks(Math.floor(this.viewport.height/20)).forEach((function(e){t.dashedLines.append("line").classed("dashed-line",!0).attr("x1",0).attr("y1",t.yScale(e)).attr("x2",t.viewport.width).attr("y2",t.yScale(e))})),this.data instanceof Array)this.line.datum(this.data).attr("d",n).attr("stroke",this.conf.name===f||this.conf.name===m||this.conf.name===p?"url(#linegradient)":T[0]),"update"===e&&this.line.attr("stroke-dasharray",this.line.node().getTotalLength()+" "+this.line.node().getTotalLength()).attr("stroke-dashoffset",this.line.node().getTotalLength()).transition().duration(700).attr("stroke-dashoffset",0),"start"===e&&this.svg.attr("opacity",0).transition(a).attr("opacity",1),this.svg.selectAll(".dot");else if("object"===typeof this.data){var o=0;for(var s in this.data)this.line[o].datum(this.data[s]).attr("d",n),"update"===e&&this.line[o].attr("stroke-dasharray",this.line[o].node().getTotalLength()+" "+this.line[o].node().getTotalLength()).attr("stroke-dashoffset",this.line[o].node().getTotalLength()).transition().duration(700).attr("stroke-dashoffset",0),"start"===e&&this.svg.attr("opacity",0).transition(a).attr("opacity",1),this.svg.selectAll(".dot"),o++}}},{key:"clean",value:function(){delete this.svg,delete this.svgHTML,delete this.viewport,delete this.margin,delete this.data,delete this.liveData,delete this.yScale,delete this.xScale,delete this.conf,delete this.tooltip,delete this.line,delete this.xAxis,delete this.yAxis,delete this.clip,delete this.dashedLines}},{key:"resize",value:function(){this.conf.name!==f&&this.conf.name!==m&&this.conf.name!==p||z.drawGradient(this.svg,this.viewport,this.conf.name),this.title.attr("x",this.viewport.width/2).attr("y",-this.margin.top/2),E.j(this.svgHTML).select("foreignObject").attr("transform","translate(".concat(this.viewport.width+this.margin.left,", ").concat(this.viewport.height/2,")")),this.clip.attr("width",this.viewport.width).attr("height",this.viewport.height),0!==this.liveData.length?(this.getXScale(this.liveData),this.getYScale(this.liveData),this.plotLive()):this.live||(this.getXScale(this.data),this.getYScale(this.data),this.plot())}},{key:"getXScale",value:function(e){if(e instanceof Array)this.xScale=E.i().domain([new Date(e[0].time),new Date(e[e.length-1].time)]).range([0,this.viewport.width]);else if("object"===typeof e){var t=[];for(var a in e){var n;(n=t).push.apply(n,Object(P.a)(E.f(e[a],(function(e){return e.time}))))}t=E.f(t),this.xScale=E.i().domain([new Date(t[0]),new Date(t[1])]).range([0,this.viewport.width])}}},{key:"getYScale",value:function(e){if(e instanceof Array)this.yScale=E.h().domain(E.f(e,(function(e){return e.value}))).range([this.viewport.height,0]);else if("object"===typeof e){var t=[];for(var a in e)t.push.apply(t,Object(P.a)(E.f(e[a],(function(e){return e.value}))));this.yScale=E.h().domain(E.f(t)).range([this.viewport.height,0])}}}]),e}();function F(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function H(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?F(a,!0).forEach((function(t){Object(j.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):F(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var R=function(e){var t=e.viewport,a=e.data,r=e.conf,o=e.control,c=void 0===o?{shouldRenderLive:!0}:o,l=Object(n.useRef)(null),h=Object(n.useState)(!1),u=Object(s.a)(h,2),d=u[0],f=u[1],m=Object(n.useState)([{timePeriod:5,selected:!0},{timePeriod:15,selected:!1},{timePeriod:30,selected:!1}]),p=Object(s.a)(m,2),v=p[0],g=p[1],w=Object(n.useState)(null),b=Object(s.a)(w,2),j=b[0],x=b[1];return Object(n.useEffect)((function(){a&&j&&l.current&&j.setData(a)}),[a,j]),Object(n.useEffect)((function(){j&&j.setConf(H({},r,{timePeriod:v.filter((function(e){return e.selected}))[0]}),a)}),[r,j,a,v]),Object(n.useEffect)((function(){j&&j.plot("start")}),[j]),Object(n.useEffect)((function(){return function(){var e=document.getElementById(r.id);e&&l.current&&l.current.removeChild(e)}}),[r.id]),Object(n.useEffect)((function(){if(l.current){var e=l.current;if(1===e.childNodes.length){E.j(e).append("svg").attr("id",r.id).attr("width",t.width).attr("height",t.height);var n=document.getElementById(r.id);if(n){var i=new M({svg:n,viewport:t,data:a,conf:H({},r,{timePeriod:v.filter((function(e){return e.selected}))[0]})});x(i)}return function(){j&&j.clean()}}}}),[r,j,a,v,t]),Object(n.useEffect)((function(){if(l.current){var e=document.getElementById(r.id);if(e){var a=e.getBoundingClientRect();a.height===t.height&&a.width===t.width||j&&j.setViewport(t)}}}),[r.id,j,t]),Object(n.useEffect)((function(){if(j&&d){j.goLive();var e=setInterval(Object(O.a)(y.a.mark((function e(){var t,a;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://dowav-api.herokuapp.com/api/live/".concat(r.name));case 2:return t=e.sent,e.next=5,t.json();case 5:a=e.sent,r.zone?j.addLiveData(a[r.zone-1]):console.error("Please specify zone for Graphh with name "+r.name);case 7:case"end":return e.stop()}}),e)}))),2e3);return function(){clearInterval(e)}}}),[r.name,r.zone,j,d]),i.a.createElement("div",{className:"graph ".concat(r.name," ").concat(d?"live":"")},i.a.createElement("div",{ref:l},i.a.createElement(S,{shouldRenderLive:c.shouldRenderLive,live:d,setLive:function(){d&&j&&j.goHistory(),f(!d)},setTimePeriod:function(e){var t=5;e.forEach((function(e){e.selected&&(t=e.timePeriod)}));var n=t/5;if(a instanceof Array)a.length>2*n&&g(e);else if("object"===typeof a){Object.keys(a).every((function(e){return a[e].length>2*n}))&&g(e)}},conf:H({},r,{timePeriod:v})})))},I=a(10),q=a.n(I),B={timeout:{title:"Error",message:"Looks like the server is taking to long to respond, please try again in sometime.",actions:["refetch"]},fetchFail:{title:"Error",message:"We can't get data right now. Try a little bit later",actions:["refetch"]},noData:{title:"No Data.",message:"Seems like there is no data available at the moment.",actions:["refetch"]}},G={hostname:"https://dowav-api.herokuapp.com"};function Y(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Z(e){var t=window.localStorage.getItem(e+"lastFetched");if(t&&q()(+t).isAfter(q()().add(-5,"minutes"))){var a=window.localStorage.getItem(e);if(a)return JSON.parse(a)}return null}function X(e){if(void 0===e)return"";var t=Object.keys(e);if(0===t.length)return"";for(var a="?",n=0;n<t.length;n++)a+="".concat(t[n],"=").concat(e[t[n]]).concat(n===t.length-1?"":"&");return a}function J(e){var t=e.useCache?Z(e.query.endpoint):null,a=Object(n.useState)({loading:!t,data:t||null,error:null}),i=Object(s.a)(a,2),r=i[0],o=i[1];function c(){new Promise(function(){var t=Object(O.a)(y.a.mark((function t(a,n){var i,r,o,s;return y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=Date.now(),r=setTimeout((function(){n(B.timeout)}),1e4),t.prev=2,t.next=5,fetch("".concat(G.hostname).concat(e.query.endpoint).concat(X(e.query.params)));case 5:return o=t.sent,t.next=8,o.json();case 8:s=t.sent,clearTimeout(r),null===s&&n(B.noData),e.useCache&&(window.localStorage.setItem(e.query.endpoint,JSON.stringify(s)),window.localStorage.setItem(e.query.endpoint+"lastFetched",Date.now()+"")),Date.now()-i>500?a(s):setTimeout((function(){a(s)}),Date.now()-i),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(2),n(B.fetchFail);case 18:case"end":return t.stop()}}),t,null,[[2,15]])})));return function(e,a){return t.apply(this,arguments)}}()).then((function(e){o({loading:!1,data:e,error:null})})).catch((function(e){o({loading:!1,error:e,data:null})}))}return Object(n.useEffect)((function(){if(0!==e.refetch)if(e.useCache){var t=Z(e.query.endpoint);t?o({loading:!1,data:t,error:null}):(o({loading:!0,data:null,error:null}),c())}else o({loading:!0,data:null,error:null}),c()}),[e.refetch]),Object(n.useEffect)((function(){t||c()}),[]),function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Y(a,!0).forEach((function(t){Object(j.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Y(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},r)}var V=a(19),_=a(20);function Q(){var e=Object(V.a)(["\n  cx: 50%;\n  cy: 50%;\n  r: 50;\n  fill: none;\n  stroke-width: 10px;\n  stroke-dasharray: 160;\n  transform-origin: 50% 50%;\n  animation: "," 2s ease infinite;\n"]);return Q=function(){return e},e}function U(){var e=Object(V.a)(["\n    0%{\n        stroke-dashoffset: 290;\n    }\n    50%{\n        stroke-dashoffset: 50;\n    }\n    100%{\n        stroke-dashoffset: 290;\n    }\n"]);return U=function(){return e},e}var W=Object(_.b)(U()),K=_.a.circle(Q(),W),$=function(e){var t=e.size,a=e.currentOption,n=void 0===a?p:a;return i.a.createElement("svg",{stroke:A[n][1],width:t.width,height:t.height,className:"loader"},i.a.createElement(K,null))};function ee(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function te(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ee(a,!0).forEach((function(t){Object(j.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ee(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var ae=function(e){var t=e.error,a=e.onRefetch,n=void 0===a?function(){return console.warn("You haven't passed a fucntion")}:a,r=e.size,o=void 0===r?{width:"100%",height:"100%"}:r;return i.a.createElement("div",{className:"error-box",style:te({},o)},i.a.createElement("h1",null,t.title),i.a.createElement("p",null,t.message),t&&t.actions&&t.actions.includes("refetch")?i.a.createElement("div",null,i.a.createElement(u.b,{size:"40",color:"white",className:"refetch-icon",onClick:n})):null)},ne=function(e){var t=e.currentOption,a=Object(n.useState)(0),r=Object(s.a)(a,2),o=r[0],c=r[1],l=Object(n.useState)(null),h=Object(s.a)(l,2),u=h[0],d=h[1],f=Object(n.useRef)(null),m=J({useCache:!0,query:{endpoint:"/api/historic/".concat(t.toLowerCase()),params:{from:1,to:Math.floor(Date.now()/1e3)}},refetch:o}),p=m.loading,v=m.data,g=m.error,w=function(){if(f.current){var e=f.current.getBoundingClientRect();d({width:e.width,height:e.height})}};return Object(n.useEffect)((function(){return f.current&&w(),window.addEventListener("resize",w),function(){return window.removeEventListener("resize",w)}}),[]),i.a.createElement("div",{ref:f,className:"graph-view"},u?i.a.createElement(i.a.Fragment,null,p?i.a.createElement($,{size:u,currentOption:t}):g?i.a.createElement("div",{className:"error-message"},i.a.createElement(ae,{error:g,onRefetch:function(){c(o+1)}})):i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"graph-view-row"},v[0]instanceof Array&&v[0].length>0?i.a.createElement(R,{data:v[0],viewport:{width:(u.width-50)/3,height:(u.height-100)/2},conf:{title:"Zone 1",name:t,id:t+1,zone:1}}):i.a.createElement(ae,{error:{title:"No data.",message:"It seems like there is no data at the moment."},size:{width:(u.width-50)/3,height:u.height/2}}),v[1]instanceof Array&&v[1].length>0?i.a.createElement(R,{data:v[1],viewport:{width:(u.width-50)/3,height:(u.height-100)/2},conf:{title:"Zone 2",name:t,id:t+2,zone:2}}):i.a.createElement(ae,{error:{title:"No data.",message:"It seems like there is no data at the moment."},size:{width:(u.width-50)/3,height:u.height/2}}),v[2]instanceof Array&&v[2].length>0?i.a.createElement(R,{data:v[2],viewport:{width:(u.width-50)/3,height:(u.height-100)/2},conf:{title:"Zone 3",name:t,id:t+3,zone:3}}):i.a.createElement(ae,{error:{title:"No data.",message:"It seems like there is no data at the moment."},size:{width:(u.width-50)/3,height:u.height/2}})),i.a.createElement("div",{className:"graph-view-row"},v.every((function(e){return e}))?i.a.createElement(R,{data:{zoneA:v[0],zoneB:v[1],zoneC:v[2]},control:{shouldRenderLive:!1},viewport:{width:u.width-10,height:(u.height-100)/2},conf:{margin:{top:40,left:40,right:120,bottom:40},title:"All Zones",name:t,id:t+4}}):null))):null)};var ie=function(e){var t=e.setFilter,a=e.setCounter,r=Object(n.useState)(""),o=Object(s.a)(r,2),c=o[0],l=o[1],h=Object(n.useState)(!1),u=Object(s.a)(h,2),d=u[0],f=u[1],m=Object(n.useCallback)(function(){var e=Date.now(),t=-1;return function(a,n){var i=Date.now();function r(){var e=a.target.value.split(" ").filter((function(e){return"#"===e.charAt(0)})).map((function(e){return e.slice(1)}));n((function(t){return function(t){return t.entities.hashtags.some((function(t){return e.map((function(e){return new RegExp(e,"g")})).some((function(e){return t.text.match(e)}))}))}}))}i-e>300?(e=i,clearTimeout(t),r()):(a.persist(),clearTimeout(t),t=setTimeout((function(){e=Date.now(),r()}),300))}}(),[]);return i.a.createElement("div",{className:"input-bar"},i.a.createElement("input",{placeholder:"Ask a question or filter using #",value:c,onChange:function(e){var a=e.target.value;l(a),a.includes("#")?(m(e,t),d&&f(!1)):"?"===a.charAt(a.length-1)?f(!0):(d&&f(!1),setTimeout((function(){return t(null)}),300))}}),i.a.createElement("button",{className:"question-send",disabled:!d,onClick:Object(O.a)(y.a.mark((function e(){var t;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=new URLSearchParams).append("message",c),e.next=4,fetch("https://dowav-api.herokuapp.com/api/tweet/question",{method:"POST",body:t});case 4:200===e.sent.status&&a((function(e){return e+1}));case 6:case"end":return e.stop()}}),e)})))},"Ask"))};var re=function(e){var t=e.data;return i.a.createElement("div",{key:t.created_at,className:"tweet"},i.a.createElement("div",{className:"tweet-header"},i.a.createElement("img",{src:t.user.profile_image_url,width:"24px",height:"24px"}),i.a.createElement("h4",null,t.user.name),i.a.createElement("p",null,"@",t.user.screen_name)),i.a.createElement("div",{className:"body"},i.a.createElement("p",null,function(e){var t=e.entities.hashtags;if(0===t.length)return e.text;var a=[];return t.forEach((function(t,n,r){a.push(0===n?e.text.slice(0,t.indices[0]):e.text.slice(r[n-1].indices[1],t.indices[0])),a.push(i.a.createElement("span",{className:"hashtag"},e.text.slice(t.indices[0],t.indices[1]))),n===r.length-1&&a.push(e.text.slice(t.indices[1]))})),i.a.createElement("span",null,a)}(t))),i.a.createElement("div",{className:"footer"},i.a.createElement("p",{className:"time"},q()(t.created_at).fromNow())))},oe=function(){var e=Object(n.useState)(0),t=Object(s.a)(e,2),a=t[0],r=t[1],o=J({query:{endpoint:"/api/tweets"},useCache:!1,refetch:a}),c=o.data,l=o.loading,h=o.error,u=Object(n.useState)(null),d=Object(s.a)(u,2),f=d[0],m=d[1],p=f?c.filter(f).map((function(e){return i.a.createElement(re,{data:e})})):null;return i.a.createElement("div",{className:"twitter-board"},l?i.a.createElement($,{size:{width:"100%",height:"100%"}}):h?null:c&&c.length?i.a.createElement("div",{className:"tweets"},i.a.createElement("div",{className:"control"},i.a.createElement("h2",null,"Tweets"),i.a.createElement(ie,{setFilter:m,setCounter:r}),p?i.a.createElement("p",{className:"stats"},"".concat(p.length," out of ").concat(c.length," shown.")):null),i.a.createElement("div",{className:"card-list"},p||c.map((function(e){return i.a.createElement(re,{data:e})})))):null)},se=i.a.createContext({data:[],appendData:function(e){throw new Error("appenData() not implemented.")}}),ce=function(){var e=Object(n.useContext)(se).data;return i.a.createElement("div",{className:"history-list"},i.a.createElement("h1",null,"History"),i.a.createElement("h4",null,"Last 24 hours"),i.a.createElement("div",{className:"historic-item-list"},e.map((function(e,t){if(0===e.value)return i.a.createElement("div",{key:e.time+" - "+t,className:"historic-item",style:{background:"rgb(120, 120, 120)"}},"".concat(q()(e.time).format("D MMM HH:mm:ss")," - No Location\n        "));var a=255-30*(e.value-1);return i.a.createElement("div",{key:e.time+" - "+t,className:"historic-item",style:{background:"rgb(".concat(a,", ").concat(a,", ").concat(a,")")}},"".concat(q()(e.time).format("D MMM HH:mm:ss")," - Zone ").concat(e.value))}))))},le=a(2),he=a(31),ue=a(32),de=function e(t){var a=this;Object(L.a)(this,e),this.scene=void 0,this.camera=void 0,this.renderer=void 0,this.controls=void 0,this.cube=void 0,this.locationData=void 0,this.labModelLoaded=void 0,this.createBox=function(){var e=new le.c(10.2,2.5,4.5333),t=[new le.G({color:2794705,transparent:!0,opacity:.65,side:le.i}),new le.G({color:2794705,transparent:!0,opacity:.7,side:le.i}),new le.G({color:2794705,transparent:!0,opacity:.66,side:le.i}),new le.G({color:2794705,transparent:!0,opacity:.67,side:le.i}),new le.G({color:2794705,transparent:!0,opacity:.68,side:le.i}),new le.G({color:2794705,transparent:!0,opacity:.69,side:le.i})],a=new le.F(e,t);return a.position.set(-14,10,-1e4),a},this.updateViewport=function(e){a.camera.aspect=e.width/e.height,a.camera.updateProjectionMatrix(),a.renderer.setSize(e.width,e.height)},this.highlightZone=function(){a.locationData&&a.cube.position.set(0,1.4,4.53*(a.locationData.value-1)-4.53)},this.addLocationData=function(e){0!==e.value?(a.locationData=e,a.highlightZone()):a.cube.position.set(-14,10,-1e4)},this.animate=function(){requestAnimationFrame(a.animate),a.controls.update(),a.renderer.render(a.scene,a.camera)},this.scene=new le.Z,this.locationData=null,this.camera=new le.P(75,t.viewport.width/t.viewport.height,.1,1e3),this.camera.position.set(-14,10,-9),this.camera.lookAt(0,0,0),this.controls=new ue.a(this.camera,t.container),this.controls.minDistance=3,this.controls.maxDistance=60,this.controls.maxPolarAngle=Math.PI/2.1,this.renderer=new le.pb({alpha:!0}),this.renderer.setClearColor(0,0),this.renderer.setSize(t.viewport.width,t.viewport.height),t.container.appendChild(this.renderer.domElement),this.labModelLoaded=!1;var n=new le.Q(16777215,1.6,0);n.position.set(0,40,0),this.scene.add(n);var i=new le.Q(16777215,.8,0);i.position.set(-20,12,-25),this.scene.add(i);var r=new le.Q(16777215,.8,0);r.position.set(18,12,18),this.scene.add(r),this.cube=this.createBox(),(new he.a).load("".concat("","/labmodel.glb"),(function(e){a.labModelLoaded=!0,a.scene.add(e.scene),a.controls.update(),a.scene.add(a.cube)}),(function(e){console.log("".concat(e.loaded/e.total*100,"% loaded"))}),(function(e){console.log("ERROR. Can't load the model"),console.log(e)})),requestAnimationFrame(this.animate),this.animate()},fe=function(e){var t=e.viewport,a=Object(n.useRef)(null),r=Object(n.useState)(null),o=Object(s.a)(r,2),c=o[0],l=o[1],h=Object(n.useContext)(se),u=h.data,d=h.appendData;return Object(n.useEffect)((function(){a.current&&!c&&l(new de({viewport:t,container:a.current}))}),[a.current]),Object(n.useEffect)((function(){c&&c.updateViewport(t)}),[t]),Object(n.useEffect)((function(){if(u.length>0&&c){var e=u[u.length-1];c.addLocationData(e);var t=setInterval(Object(O.a)(y.a.mark((function e(){var t,a;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("https://dowav-api.herokuapp.com/api/location/live");case 3:return t=e.sent,e.next=6,t.json();case 6:a=e.sent,d(a),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.log(e.t0);case 13:case"end":return e.stop()}}),e,null,[[0,10]])}))),500);return function(){clearInterval(t)}}}),[u,c]),i.a.createElement("div",{ref:a,style:{width:t.width,height:t.height,outline:"none"}})};function me(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function pe(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?me(a,!0).forEach((function(t){Object(j.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):me(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var ve=function(){var e=Object(n.useState)(0),t=Object(s.a)(e,2),a=(t[0],t[1],Object(n.useState)([])),r=Object(s.a)(a,2),o=r[0],c=r[1],l=Object(n.useState)(null),h=Object(s.a)(l,2),u=h[0],d=h[1],f=Object(n.useRef)(null),m=J({useCache:!1,query:{endpoint:"/api/location/historic"},refetch:0}),p=m.loading,v=m.data,g=m.error,w=function(){if(f.current){var e=f.current.getBoundingClientRect();d({width:e.width,height:e.height})}};return Object(n.useEffect)((function(){return f.current&&w(),window.addEventListener("resize",w),function(){return window.removeEventListener("resize",w)}}),[]),Object(n.useEffect)((function(){v&&c(v)}),[v]),i.a.createElement("div",{ref:f,className:"movement-view"},u?i.a.createElement(i.a.Fragment,null,i.a.createElement(se.Provider,{value:{data:o,appendData:function(e){0===o.length?c((function(t){return[].concat(Object(P.a)(t),[e])})):o[o.length-1].time<e.time&&c((function(t){return[].concat(Object(P.a)(t),[e])}))}}},i.a.createElement(fe,{viewport:pe({},u,{width:u.width-250})}),p?i.a.createElement($,{size:{width:250,height:"100%"}}):g?i.a.createElement(ae,{error:{title:"Something bad happened.",message:"We can't get location data at the moment. Please try later."},size:{width:250,height:"100%"}}):v?i.a.createElement(ce,null):null)):null)},ge=function(){var e=Object(n.useContext)(v).currentOption,t=null;switch(e){case f:case m:case p:t=i.a.createElement(ne,{key:e,currentOption:e});break;case"Movement":t=i.a.createElement(ve,null);break;case"Twitter":t=i.a.createElement(oe,null);break;default:t=i.a.createElement("div",{className:"not-implemented"},i.a.createElement("h1",null,"This page is under construction"),i.a.createElement(u.a,{size:180}))}return i.a.createElement("div",{className:"switch"},t)},we=(a(48),function(){return Object(n.useEffect)((function(){var e=new WebSocket("ws://dowav-api.herokuapp.com/api/notifications");return e&&(e.onmessage=function(e){var t=JSON.parse(e.data);Object(c.b)(t.message,{type:t.type})}),function(){e.close()}}),[]),i.a.createElement("div",{className:"dashboard"},i.a.createElement(w,null),i.a.createElement(ge,null),i.a.createElement(c.a,null))}),be=function(){var e=Object(n.useState)("Twitter"),t=Object(s.a)(e,2),a=t[0],r=t[1];return i.a.createElement(v.Provider,{value:{currentOption:a,setCurrentOption:function(e){r(e)}}},i.a.createElement(we,null))};o.a.render(i.a.createElement(be,null),document.getElementById("root"))}},[[36,1,2]]]);
//# sourceMappingURL=main.c275ce0a.chunk.js.map